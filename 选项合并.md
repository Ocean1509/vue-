
生命周期图

```
<div id="app"></div>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.8/dist/vue.js"></script>
var vm = new Vue({
  el: '#app',
  data: {
    message: '选项合并'
  },
  components: {
    'components': {}
  }
})
```
vue工程化都是从创建一个vue实例开始，在创建一个vue实例之后的第一步，系统需要进行init，也就是初始化数据的过程。
```
// Vue 构造函数
function Vue (options) {
  if (!(this instanceof Vue)
  ) {
    // 规定vue只能通过new实例化创建，否则抛出异常
    warn('Vue is a constructor and should be called with the `new` keyword');
  }
  this._init(options);
}

// 在引进Vue时，会执行initMixin方法，这个方法只单纯在vue的原型上定义一个init的方法，而init方法只在在实例化Vue时执行
initMixin(Vue);

// 其他初始化过程。。。
···

```
在这一章节中，我们将围绕vue数据的初始化展开解析。

#### 1.1 Vue构造函数的默认选项
```
var ASSET_TYPES = [
  'component',
  'directive',
  'filter'
];
Vue.options = Object.create(null);
ASSET_TYPES.forEach(function (type) {
  Vue.options[type + 's'] = Object.create(null);
});
Vue.options._base = Vue;
```
Vue构造函数自身有四个默认配置选项，分别是component，directive， filter以及返回自身构造器的_base(这里先不展开对每个属性内容的介绍)。这四个属性挂载在构造函数的options属性上。


我们抓取_init方法合并选项的核心部分代码如下:
```
function initMixin (Vue) {
    Vue.prototype._init = function (options) {
      var vm = this;
      // a uid
      // 记录实例化多少个vue对象
      vm._uid = uid$3++;

      // 选项合并，将合并后的选项赋值给实例的$options属性
      vm.$options = mergeOptions(
        resolveConstructorOptions(vm.constructor), // 返回Vue构造函数自身的配置项
        options || {},
        vm
      );
    };
  }
```
其中每个vue实例对象都有一个$options属性，这个属性会将new Vue(options)用户传递的options和Vue构造函数自身的options进行合并。


#### 1.2 合并过程
选项合并的核心代码如下，我们分别来阐述这一过程。
```
 function mergeOptions ( parent, child, vm ) {
    {
      checkComponents(child); // components规范检测
    }

    if (typeof child === 'function') {
      child = child.options;
    }

    if (!child._base) {
      if (child.extends) {
        parent = mergeOptions(parent, child.extends, vm);
      }
      if (child.mixins) {
        for (var i = 0, l = child.mixins.length; i < l; i++) {
          parent = mergeOptions(parent, child.mixins[i], vm);
        }
      }
    }

    var options = {};
    var key;
    for (key in parent) {
      mergeField(key);
    }
    for (key in child) {
      if (!hasOwn(parent, key)) {
        mergeField(key);
      }
    }
    function mergeField (key) {
      var strat = strats[key] || defaultStrat;
      options[key] = strat(parent[key], child[key], vm, key);
    }
    return options
  }
```
##### 1.2.1 components规范检验
选项合并过程我们更多的不可控在于不知道用户传了哪些配置选项，这些配置是否符合规范，例如我们可以在vue实例化时传入组件配置注册组件，然后，组件命名需要遵守很多规范，比如不能用html保留的标签(如：img,p),且只能以字母开头等。因此在选项合并之前，需要对规范进行检查。

